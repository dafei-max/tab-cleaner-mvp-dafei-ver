# Tab Cleaner å›¾ç‰‡æ•æ‰æ–¹å¼å®Œæ•´åˆ—è¡¨

## ğŸ“¸ å›¾ç‰‡æ•æ‰æ–¹å¼æ€»è§ˆ

æ’ä»¶ç›®å‰æ”¯æŒ **8 ç§**å›¾ç‰‡æ•æ‰æ–¹å¼ï¼Œåˆ†ä¸ºä¸¤å¤§ç±»ï¼š

### ğŸ¯ æ‰‹åŠ¨æ•æ‰ï¼ˆç”¨æˆ·ä¸»åŠ¨æ“ä½œï¼‰
1. **æ‹–æ‹½å›¾ç‰‡åˆ°æ¡Œå® **
2. **æ‚¬åœç‚¹å‡»æŒ‰é’®**
3. **å³é”®èœå•**
4. **å¿«æ·é”®ä¿å­˜**
5. **æˆªå›¾æ¨¡å¼ï¼ˆAlt+æ‹–æ‹½ï¼‰**

### ğŸ¤– è‡ªåŠ¨æ•æ‰ï¼ˆæ‰¹é‡/åå°ï¼‰
6. **è‡ªåŠ¨ OpenGraph æŠ“å–**
7. **æ‰¹é‡æ”¶é›†ï¼ˆæ¸…ç†æ ‡ç­¾é¡µæ—¶ï¼‰**
8. **æ ‡ç­¾é¡µæˆªå›¾å…œåº•**

---

## 1ï¸âƒ£ æ‹–æ‹½å›¾ç‰‡åˆ°æ¡Œå®  ğŸ–±ï¸

**è§¦å‘æ–¹å¼**ï¼šç”¨æˆ·æ‹–æ‹½ç½‘é¡µä¸­çš„å›¾ç‰‡åˆ°å³ä¸‹è§’æ¡Œå® 

**å®ç°è·¯å¾„**ï¼š
```
ç”¨æˆ·æ“ä½œ: æ‹–æ‹½å›¾ç‰‡
  â†“
image_capture_enhanced.js
  - initDragAndDrop()
  - dragstart äº‹ä»¶ç›‘å¬
  - dragover äº‹ä»¶ç›‘å¬ï¼ˆè½¨è¿¹ç»˜åˆ¶ã€ç£å¸æ•ˆæœï¼‰
  - dragend äº‹ä»¶ç›‘å¬
  - playFlyInAnimation() // é£å…¥åŠ¨ç”»
  - captureImage()
  â†“
background.js
  - handleSaveCapturedImage()
  - save-captured-image æ¶ˆæ¯å¤„ç†
  â†“
åç«¯ API: /api/v1/opengraph/embed
```

**æ–‡ä»¶ä½ç½®**ï¼š
- `frontend/public/assets/image_capture_enhanced.js` (è¡Œ 413-535)

**ç‰¹ç‚¹**ï¼š
- âœ… æ”¯æŒæ‹–æ‹½è½¨è¿¹ï¼ˆè“è‰²çº¿æ¡ï¼‰
- âœ… ç£å¸æ•ˆæœï¼ˆæ¥è¿‘æ¡Œå® æ—¶è‡ªåŠ¨æ”¾å¤§ï¼‰
- âœ… é£å…¥åŠ¨ç”»ï¼ˆå¡ç‰‡é£å‘æ¡Œå® ï¼‰
- âœ… æ¡Œå® æ•°å­—è·³åŠ¨åé¦ˆ

---

## 2ï¸âƒ£ æ‚¬åœç‚¹å‡»æŒ‰é’® â•

**è§¦å‘æ–¹å¼**ï¼šé¼ æ ‡æ‚¬åœåœ¨å›¾ç‰‡ä¸Šï¼Œç‚¹å‡»å‡ºç°çš„"+"æŒ‰é’®

**å®ç°è·¯å¾„**ï¼š
```
ç”¨æˆ·æ“ä½œ: é¼ æ ‡æ‚¬åœå›¾ç‰‡
  â†“
image_capture_enhanced.js
  - initImageMarkers()
  - mouseover äº‹ä»¶ç›‘å¬
  - createMarkerIcon() // åˆ›å»º"+"æŒ‰é’®
  - ç‚¹å‡»äº‹ä»¶ç›‘å¬
  - captureImage()
  â†“
background.js
  - handleSaveCapturedImage()
  â†“
åç«¯ API: /api/v1/opengraph/embed
```

**æ–‡ä»¶ä½ç½®**ï¼š
- `frontend/public/assets/image_capture_enhanced.js` (è¡Œ 537-750)

**ç‰¹ç‚¹**ï¼š
- âœ… 80ms å¿«é€Ÿå“åº”
- âœ… æŒ‰é’®å‘å…‰æ•ˆæœï¼ˆæ‚¬åœæ—¶ï¼‰
- âœ… åªæ˜¾ç¤º"+"å·ï¼ˆæ— æ–‡å­—ï¼‰
- âœ… è‡ªåŠ¨è·Ÿéšå›¾ç‰‡ä½ç½®

---

## 3ï¸âƒ£ å³é”®èœå• ğŸ“‹

**è§¦å‘æ–¹å¼**ï¼šå³é”®ç‚¹å‡»å›¾ç‰‡ï¼Œé€‰æ‹©"æ”¶è—åˆ° Tab Cleaner"

**å®ç°è·¯å¾„**ï¼š
```
ç”¨æˆ·æ“ä½œ: å³é”®ç‚¹å‡»å›¾ç‰‡
  â†“
background.js
  - createContextMenus() // åˆ›å»ºå³é”®èœå•
  - chrome.contextMenus.onClicked
  - handleSaveImageFromContextMenu()
  â†“
content.js / image_capture_enhanced.js
  - save-image-from-context-menu æ¶ˆæ¯å¤„ç†
  - captureImage()
  â†“
background.js
  - handleSaveCapturedImage()
  â†“
åç«¯ API: /api/v1/opengraph/embed
```

**æ–‡ä»¶ä½ç½®**ï¼š
- `frontend/public/assets/background.js` (è¡Œ 57-88, 93-133)
- `frontend/public/assets/image_capture_enhanced.js` (è¡Œ 580-620)

**ç‰¹ç‚¹**ï¼š
- âœ… ç³»ç»ŸåŸç”Ÿå³é”®èœå•
- âœ… æ”¯æŒæ‰€æœ‰å›¾ç‰‡ï¼ˆåŒ…æ‹¬èƒŒæ™¯å›¾ã€CSS å›¾ç­‰ï¼‰

---

## 4ï¸âƒ£ å¿«æ·é”®ä¿å­˜ âŒ¨ï¸

**è§¦å‘æ–¹å¼**ï¼šæ‚¬åœåœ¨å›¾ç‰‡ä¸Šï¼ŒæŒ‰ `âŒ˜/Ctrl + Shift + S`

**å®ç°è·¯å¾„**ï¼š
```
ç”¨æˆ·æ“ä½œ: æ‚¬åœå›¾ç‰‡ + å¿«æ·é”®
  â†“
image_capture_enhanced.js
  - initKeyboardShortcuts()
  - keydown äº‹ä»¶ç›‘å¬
  - æ£€æµ‹å¿«æ·é”®ç»„åˆ
  - captureImage()
  â†“
background.js
  - handleSaveCapturedImage()
  â†“
åç«¯ API: /api/v1/opengraph/embed
```

**æ–‡ä»¶ä½ç½®**ï¼š
- `frontend/public/assets/image_capture_enhanced.js` (è¡Œ 790-811)

**ç‰¹ç‚¹**ï¼š
- âœ… è·¨å¹³å°æ”¯æŒï¼ˆMac: âŒ˜, Windows: Ctrlï¼‰
- âœ… æŒ‰ `?` æ˜¾ç¤ºå¿«æ·é”®å¸®åŠ©

---

## 5ï¸âƒ£ æˆªå›¾æ¨¡å¼ï¼ˆAlt+æ‹–æ‹½ï¼‰ğŸ“·

**è§¦å‘æ–¹å¼**ï¼šæŒ‰ä½ `Alt` é”®ï¼Œæ‹–æ‹½é€‰æ‹©åŒºåŸŸæˆªå›¾

**å®ç°è·¯å¾„**ï¼š
```
ç”¨æˆ·æ“ä½œ: Alt + æ‹–æ‹½é€‰æ‹©åŒºåŸŸ
  â†“
screenshot_capture.js
  - keydown äº‹ä»¶ç›‘å¬ï¼ˆAlt é”®ï¼‰
  - mousedown/mousemove/mouseup äº‹ä»¶
  - ç»˜åˆ¶é€‰æ‹©æ¡†
  - chrome.tabs.captureVisibleTab()
  - Canvas API è£å‰ª
  - save-captured-image æ¶ˆæ¯
  â†“
background.js
  - handleSaveCapturedImage()
  â†“
åç«¯ API: /api/v1/opengraph/embed
```

**æ–‡ä»¶ä½ç½®**ï¼š
- `frontend/public/assets/screenshot_capture.js`

**ç‰¹ç‚¹**ï¼š
- âœ… æ”¯æŒ Canvas/Video æˆªå›¾
- âœ… åº”å¯¹ç‰¹æ®Šæ¸²æŸ“åœºæ™¯ï¼ˆFigmaã€Canvaï¼‰
- âœ… æ¡†é€‰åŒºåŸŸæˆªå›¾

---

## 6ï¸âƒ£ è‡ªåŠ¨ OpenGraph æŠ“å– ğŸ¤–

**è§¦å‘æ–¹å¼**ï¼šé¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œï¼ˆcontent scriptï¼‰

**å®ç°è·¯å¾„**ï¼š
```
é¡µé¢åŠ è½½
  â†“
manifest.json
  - content_scripts: opengraph_local_v2.js
  â†“
opengraph_local_v2.js
  - è‡ªåŠ¨æå– OpenGraph æ•°æ®
  - æ™ºèƒ½é¦–å›¾æ£€æµ‹ï¼ˆå¤šç»´åº¦è¯„åˆ†ï¼‰
  - æ”¯æŒ SPA è·¯ç”±å˜åŒ–ç›‘å¬
  - ç¼“å­˜æœºåˆ¶
  â†“
ç­‰å¾…ç”¨æˆ·è§¦å‘"æ¸…ç†æ ‡ç­¾é¡µ"æ—¶ä½¿ç”¨
```

**æ–‡ä»¶ä½ç½®**ï¼š
- `frontend/public/assets/opengraph_local_v2.js`
- `frontend/public/manifest.json` (è¡Œ 29)

**ç‰¹ç‚¹**ï¼š
- âœ… è‡ªåŠ¨è¿è¡Œï¼Œæ— éœ€ç”¨æˆ·æ“ä½œ
- âœ… æ™ºèƒ½é¦–å›¾æ£€æµ‹ï¼ˆä½ç½®ã€å°ºå¯¸ã€å®½é«˜æ¯”ã€ä¸Šä¸‹æ–‡ï¼‰
- âœ… æ”¯æŒ SPAï¼ˆå°çº¢ä¹¦ã€Pinterest ç­‰ï¼‰
- âœ… ç½‘ç«™ç‰¹å®šè§„åˆ™ä¼˜åŒ–

---

## 7ï¸âƒ£ æ‰¹é‡æ”¶é›†ï¼ˆæ¸…ç†æ ‡ç­¾é¡µæ—¶ï¼‰ğŸ—‚ï¸

**è§¦å‘æ–¹å¼**ï¼šç”¨æˆ·ç‚¹å‡»"æ¸…ç†å½“å‰æ ‡ç­¾é¡µ"æˆ–"æ¸…ç†æ‰€æœ‰æ ‡ç­¾é¡µ"

**å®ç°è·¯å¾„**ï¼š
```
ç”¨æˆ·æ“ä½œ: ç‚¹å‡»æ¸…ç†æŒ‰é’®
  â†“
background.js
  - handleCleanCurrentTab() / handleCleanAllTabs()
  - collectTabWithGuaranteedImage() // ä¸‰å±‚ä¿é™©ç­–ç•¥
    â”œâ”€ æ­¥éª¤1: æ³¨å…¥ opengraph_local.js
    â”œâ”€ æ­¥éª¤2: å‘é€ extract-opengraph-with-wait æ¶ˆæ¯
    â”œâ”€ æ­¥éª¤3: ç­‰å¾… OG æ•°æ®ï¼ˆæœ€å¤š 8 ç§’ï¼‰
    â””â”€ æ­¥éª¤4: å¦‚æœæ— å›¾ï¼Œä½¿ç”¨æˆªå›¾å…œåº•
  â†“
opengraph_local.js / opengraph_local_v2.js
  - æå– OpenGraph æ•°æ®
  â†“
background.js
  - æ‰¹é‡ä¿å­˜åˆ° session
  - å¼‚æ­¥ç”Ÿæˆ embedding
  â†“
åç«¯ API: /api/v1/opengraph/embed
```

**æ–‡ä»¶ä½ç½®**ï¼š
- `frontend/public/assets/background.js` (è¡Œ 405-550, 750-900)

**ç‰¹ç‚¹**ï¼š
- âœ… ä¸‰å±‚ä¿é™©ç­–ç•¥ï¼ˆOG â†’ ç­‰å¾… â†’ æˆªå›¾ï¼‰
- âœ… æ‰¹é‡å¤„ç†å¤šä¸ªæ ‡ç­¾é¡µ
- âœ… è‡ªåŠ¨ç”Ÿæˆ embedding

---

## 8ï¸âƒ£ æ ‡ç­¾é¡µæˆªå›¾å…œåº• ğŸ“¸

**è§¦å‘æ–¹å¼**ï¼šå½“ OpenGraph æŠ“å–å¤±è´¥æ—¶è‡ªåŠ¨è§¦å‘

**å®ç°è·¯å¾„**ï¼š
```
OpenGraph æŠ“å–å¤±è´¥
  â†“
background.js
  - captureTabScreenshot(tabId)
  - chrome.tabs.update() // åˆ‡æ¢åˆ°ç›®æ ‡æ ‡ç­¾é¡µ
  - chrome.tabs.captureVisibleTab() // æˆªå›¾å¯è§åŒºåŸŸ
  - è¿”å› base64 å›¾ç‰‡æ•°æ®
  â†“
åˆå¹¶åˆ° OpenGraph æ•°æ®
  - is_screenshot: true
  â†“
ä¿å­˜åˆ° session
```

**æ–‡ä»¶ä½ç½®**ï¼š
- `frontend/public/assets/background.js` (è¡Œ 29-55)

**ç‰¹ç‚¹**ï¼š
- âœ… 100% ä¿è¯æœ‰å›¾ç‰‡
- âœ… åªæˆªå›¾å¯è§åŒºåŸŸï¼ˆé¦–å±ï¼‰
- âœ… é€‚ç”¨äºæ–‡æ¡£ç±»ç½‘ç«™ï¼ˆNotionã€é£ä¹¦ç­‰ï¼‰

---

## ğŸ“Š æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·æ“ä½œ / è‡ªåŠ¨è§¦å‘                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
   æ‰‹åŠ¨æ•æ‰                         è‡ªåŠ¨æ•æ‰
        â”‚                               â”‚
  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚           â”‚              â”‚                   â”‚
æ‹–æ‹½/æ‚¬åœ/å³é”®          OpenGraph æŠ“å–      æ‰¹é‡æ”¶é›†
  â”‚           â”‚              â”‚                   â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   background.js        â”‚
            â”‚  handleSaveCapturedImageâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Chrome Storage      â”‚
            â”‚   (æœ¬åœ°ç¼“å­˜)           â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   åç«¯ API             â”‚
            â”‚ /api/v1/opengraph/embedâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   ç”Ÿæˆ Embedding      â”‚
            â”‚   ä¿å­˜åˆ°æ•°æ®åº“        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ é…ç½®æ–‡ä»¶

**manifest.json** ä¸­çš„ content scripts åŠ è½½é¡ºåºï¼š
```json
"content_scripts": [
  {
    "js": [
      "assets/opengraph_local_v2.js",      // 1. OpenGraph è‡ªåŠ¨æŠ“å–
      "assets/image_capture_enhanced.js",   // 2. æ‹–æ‹½/æ‚¬åœ/å³é”®
      "assets/screenshot_capture.js",      // 3. æˆªå›¾æ¨¡å¼
      "assets/pet.js",                      // 4. æ¡Œå® 
      "assets/content.js"                   // 5. å†…å®¹è„šæœ¬
    ]
  }
]
```

---

## ğŸ“ æ€»ç»“

| æ–¹å¼ | è§¦å‘ | æ–‡ä»¶ | ç‰¹ç‚¹ |
|------|------|------|------|
| 1. æ‹–æ‹½ | ç”¨æˆ·æ‹–æ‹½ | `image_capture_enhanced.js` | æœ‰åŠ¨ç”»ã€è½¨è¿¹ã€ç£å¸ |
| 2. æ‚¬åœæŒ‰é’® | é¼ æ ‡æ‚¬åœ | `image_capture_enhanced.js` | å¿«é€Ÿå“åº”ã€å‘å…‰æ•ˆæœ |
| 3. å³é”®èœå• | å³é”®ç‚¹å‡» | `background.js` | ç³»ç»ŸåŸç”Ÿèœå• |
| 4. å¿«æ·é”® | é”®ç›˜å¿«æ·é”® | `image_capture_enhanced.js` | è·¨å¹³å°æ”¯æŒ |
| 5. æˆªå›¾æ¨¡å¼ | Alt+æ‹–æ‹½ | `screenshot_capture.js` | Canvas/Video æ”¯æŒ |
| 6. OG è‡ªåŠ¨æŠ“å– | é¡µé¢åŠ è½½ | `opengraph_local_v2.js` | è‡ªåŠ¨è¿è¡Œã€æ™ºèƒ½æ£€æµ‹ |
| 7. æ‰¹é‡æ”¶é›† | æ¸…ç†æ ‡ç­¾é¡µ | `background.js` | æ‰¹é‡å¤„ç†ã€ä¸‰å±‚ä¿é™© |
| 8. æˆªå›¾å…œåº• | OG å¤±è´¥æ—¶ | `background.js` | 100% ä¿è¯æœ‰å›¾ |

---

**æœ€åæ›´æ–°**ï¼š2024-12-19


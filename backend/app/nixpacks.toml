# Nixpacks 配置（Railway 使用）
# 解决 PEP 668 限制：Nix 环境中的 Python 是外部管理的

[phases.setup]
# 指定需要的 Nix 包
nixPkgs = ["python312", "uv"]

[phases.build]
# 使用 uv sync 安装依赖（会自动创建虚拟环境并安装所有依赖）
# uv sync 会读取 pyproject.toml 和 uv.lock，自动创建虚拟环境
cmds = [
  "uv sync --frozen",  # 使用 --frozen 确保使用 lockfile
  "playwright install chromium || echo 'Playwright installation skipped'"
]

[start]
# 使用 uv run 运行（uv 会自动使用正确的虚拟环境）
cmd = "uv run uvicorn main:app --host 0.0.0.0 --port $PORT"


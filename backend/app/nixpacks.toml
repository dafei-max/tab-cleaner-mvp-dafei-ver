# Nixpacks 配置（Railway 使用）
# 解决 PEP 668 限制：Nix 环境中的 Python 是外部管理的，需要使用 uv 或虚拟环境

[phases.setup]
# 指定需要的 Nix 包（Python）
nixPkgs = ["python312"]

[phases.install]
# 安装 uv（用于管理 Python 依赖，避免 PEP 668 限制）
cmds = [
  "curl -LsSf https://astral.sh/uv/install.sh | sh",
  "export PATH=\"$HOME/.cargo/bin:$PATH\""
]

[phases.build]
# 使用 uv 安装依赖（uv 会创建虚拟环境，避免 PEP 668 限制）
# uv 会自动处理 pyproject.toml
cmds = [
  "export PATH=\"$HOME/.cargo/bin:$PATH\"",
  "uv pip install -e .",
  "playwright install chromium --with-deps || playwright install chromium || echo 'Playwright installation skipped'"
]

[start]
# 使用 uv 运行（uv 会自动使用正确的 Python 环境）
cmd = "export PATH=\"$HOME/.cargo/bin:$PATH\" && uv run uvicorn main:app --host 0.0.0.0 --port $PORT"


# Nixpacks 配置（Railway 使用）
# 解决 PEP 668 限制：Nix 环境中的 Python 是外部管理的

[phases.setup]
# 指定需要的 Nix 包
nixPkgs = ["python312", "uv"]

[phases.build]
# 使用 uv 安装依赖（先创建虚拟环境，避免 PEP 668 限制）
# uv venv 创建虚拟环境后，使用 --python 参数指定 Python 解释器路径
cmds = [
  "uv venv",
  "uv pip install --python .venv/bin/python -e .",
  "playwright install chromium || echo 'Playwright installation skipped'"
]

[start]
# 使用虚拟环境中的 Python 直接运行 uvicorn
cmd = ".venv/bin/python -m uvicorn main:app --host 0.0.0.0 --port $PORT"


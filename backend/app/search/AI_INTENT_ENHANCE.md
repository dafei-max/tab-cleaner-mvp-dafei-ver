# AI ç”¨æˆ·æ„å›¾å¼ºåŒ–æ¨¡å—ï¼ˆRAG å¢å¼ºï¼‰

## ğŸ“‹ æ¦‚è¿°

`ai_intent_enhance.py` æ¨¡å—ä½¿ç”¨ LLMï¼ˆé€šä¹‰åƒé—®ï¼‰æ¥ç†è§£å’Œå¢å¼ºç”¨æˆ·æœç´¢æ„å›¾ï¼Œä½œä¸º RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œæé«˜æœç´¢å‡†ç¡®æ€§ã€‚

## ğŸ¯ åŠŸèƒ½

### 1. ç”¨æˆ·æ„å›¾åˆ†æï¼ˆQuery Intent Analysisï¼‰

**ä½ç½®**: `enhance_query_intent_with_ai()`

**åŠŸèƒ½**:
- åˆ†æç”¨æˆ·æŸ¥è¯¢çš„çœŸå®æ„å›¾
- æå–é¢œè‰²ã€ç‰©ä½“ã€é£æ ¼ã€æ¦‚å¿µç­‰ä¿¡æ¯
- æ‰©å±•åŒä¹‰è¯å’Œç›¸å…³è¯
- ç”Ÿæˆæœç´¢å»ºè®®ï¼ˆä¼˜å…ˆç½‘ç«™ã€è¿‡æ»¤ç±»å‹ã€ç›¸ä¼¼åº¦é˜ˆå€¼ï¼‰

**Prompt ä½ç½®**: `get_intent_analysis_prompt()`

**Prompt ç¤ºä¾‹**:
```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è®¾è®¡å¸ˆæœç´¢åŠ©æ‰‹ã€‚è¯·åˆ†æç”¨æˆ·çš„æœç´¢æŸ¥è¯¢ï¼Œç†è§£å…¶çœŸå®æ„å›¾ã€‚

ç”¨æˆ·æŸ¥è¯¢ï¼š"è“è‰²è®¾è®¡"

è¯·åˆ†æä»¥ä¸‹å†…å®¹ï¼Œå¹¶ä»¥ JSON æ ¼å¼è¿”å›ï¼š
1. æŸ¥è¯¢ç±»å‹ï¼ˆvisual/object/color/style/concept/generalï¼‰
2. æå–çš„å…³é”®ä¿¡æ¯ï¼ˆcolors/objects/styles/conceptsï¼‰
3. æŸ¥è¯¢å¢å¼ºï¼ˆæ‰©å±•åŒä¹‰è¯å’Œç›¸å…³è¯ï¼‰
4. æœç´¢å»ºè®®ï¼ˆä¼˜å…ˆç½‘ç«™ã€è¿‡æ»¤ç±»å‹ã€ç›¸ä¼¼åº¦é˜ˆå€¼ï¼‰
```

### 2. æœç´¢ç»“æœéªŒè¯ï¼ˆResult Validationï¼‰

**ä½ç½®**: `validate_search_results_with_ai()`

**åŠŸèƒ½**:
- äºŒæ¬¡éªŒè¯æœç´¢ç»“æœçš„ç›¸å…³æ€§
- è¯†åˆ«åº”è¯¥è¿‡æ»¤çš„ç»“æœ
- è¯†åˆ«åº”è¯¥æå‡ä¼˜å…ˆçº§çš„ç»“æœ

**Prompt ä½ç½®**: `get_result_validation_prompt()`

### 3. æ··åˆç­–ç•¥ï¼ˆHybrid Strategyï¼‰

**ä½ç½®**: `hybrid_intent_detection()`

**åŠŸèƒ½**:
- è§„åˆ™å¼æ–¹æ³•ï¼ˆå¿«é€Ÿï¼Œæ¯«ç§’çº§ï¼‰
- AI å¢å¼ºï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡ï¼‰
- è¶…æ—¶æ§åˆ¶ï¼ˆé»˜è®¤2ç§’ï¼‰
- ç¼“å­˜æ”¯æŒï¼ˆé¿å…é‡å¤è°ƒç”¨ï¼‰

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·æŸ¥è¯¢
  â†“
è§„åˆ™å¼å¿«é€Ÿæ£€æµ‹ï¼ˆç«‹å³è¿”å›ï¼‰
  â†“
å¼‚æ­¥è°ƒç”¨ AI å¢å¼ºï¼ˆä¸é˜»å¡ï¼‰
  â†“
å¦‚æœ AI æˆåŠŸ â†’ ä½¿ç”¨ AI ç»“æœ
å¦‚æœ AI å¤±è´¥/è¶…æ—¶ â†’ ä½¿ç”¨è§„åˆ™å¼ç»“æœ
```

## ğŸ“ Prompt é…ç½®

### æ„å›¾åˆ†æ Prompt

**æ–‡ä»¶**: `ai_intent_enhance.py` â†’ `get_intent_analysis_prompt()`

**å…³é”®è¦ç´ **:
1. **è§’è‰²è®¾å®š**: "ä¸“ä¸šçš„è®¾è®¡å¸ˆæœç´¢åŠ©æ‰‹"
2. **ä»»åŠ¡**: åˆ†æç”¨æˆ·æŸ¥è¯¢çš„çœŸå®æ„å›¾
3. **è¾“å‡ºæ ¼å¼**: JSONï¼ˆåŒ…å« query_type, extracted_info, enhanced_query, search_suggestionsï¼‰
4. **è®¾è®¡åœºæ™¯**: é’ˆå¯¹è®¾è®¡å¸ˆæ‰¾å›¾åœºæ™¯ä¼˜åŒ–

### ç»“æœéªŒè¯ Prompt

**æ–‡ä»¶**: `ai_intent_enhance.py` â†’ `get_result_validation_prompt()`

**å…³é”®è¦ç´ **:
1. **ä»»åŠ¡**: éªŒè¯æœç´¢ç»“æœçš„ç›¸å…³æ€§
2. **è¾“å‡ºæ ¼å¼**: JSONï¼ˆåŒ…å« relevant_indices, filter_out_indices, boost_indicesï¼‰
3. **åˆ†æç»´åº¦**: ç›¸å…³æ€§ã€è¿‡æ»¤å»ºè®®ã€ä¼˜å…ˆçº§æå‡

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```python
from search.ai_intent_enhance import hybrid_intent_detection

# æ··åˆæ„å›¾æ£€æµ‹ï¼ˆè§„åˆ™å¼ + AIï¼‰
intent = await hybrid_intent_detection(
    query="è“è‰²è®¾è®¡",
    use_ai=True,
    ai_timeout=2.0,
    cache={}
)

print(intent["enhanced_query"])  # AIå¢å¼ºåçš„æŸ¥è¯¢
print(intent["query_type"])      # æŸ¥è¯¢ç±»å‹
print(intent["extracted_info"])  # æå–çš„ä¿¡æ¯
```

### åœ¨æœç´¢æµç¨‹ä¸­é›†æˆ

**æ–‡ä»¶**: `smart_filter.py`

```python
# æ£€æµ‹æŸ¥è¯¢æ„å›¾ï¼ˆæ”¯æŒAIå¢å¼ºï¼‰
from .ai_intent_enhance import hybrid_intent_detection

enhanced_intent = await hybrid_intent_detection(
    query,
    use_ai=True,
    ai_timeout=2.0,
    cache={}
)
```

## âš™ï¸ é…ç½®

### API å¯†é’¥

**ç¯å¢ƒå˜é‡**: `DASHSCOPE_API_KEY`

**è·å–æ–¹å¼**: é˜¿é‡Œäº‘ DashScope æ§åˆ¶å°

### æ¨¡å‹é€‰æ‹©

**å½“å‰ä½¿ç”¨**: `qwen-turbo`ï¼ˆå¿«é€Ÿï¼Œæˆæœ¬ä½ï¼‰

**å¯é€‰**: `qwen-plus`ï¼ˆæ›´å‡†ç¡®ï¼Œä½†æ›´æ…¢æ›´è´µï¼‰

**ä½ç½®**: `ai_intent_enhance.py` â†’ `call_llm_for_intent()`

```python
response = Generation.call(
    model="qwen-turbo",  # æˆ– "qwen-plus"
    prompt=prompt,
    temperature=0.3,
    max_tokens=1000,
)
```

### è¶…æ—¶æ§åˆ¶

**é»˜è®¤**: 2ç§’

**ä½ç½®**: `hybrid_intent_detection()` â†’ `ai_timeout` å‚æ•°

**åŸå› **: é¿å…AIè°ƒç”¨å¤ªæ…¢å½±å“æœç´¢å“åº”æ—¶é—´

## ğŸ“Š æ€§èƒ½è€ƒè™‘

### æˆæœ¬

- **qwen-turbo**: çº¦ $0.001-0.01 æ¯æ¬¡æŸ¥è¯¢
- **qwen-plus**: çº¦ $0.01-0.05 æ¯æ¬¡æŸ¥è¯¢

### å»¶è¿Ÿ

- **è§„åˆ™å¼æ–¹æ³•**: < 10ms
- **AIå¢å¼º**: 100-2000msï¼ˆå–å†³äºç½‘ç»œå’Œæ¨¡å‹ï¼‰
- **æ··åˆç­–ç•¥**: è§„åˆ™å¼ç«‹å³è¿”å›ï¼ŒAIå¼‚æ­¥å¢å¼º

### ç¼“å­˜

- **æ”¯æŒ**: æ˜¯ï¼ˆé€šè¿‡ `cache` å‚æ•°ï¼‰
- **å»ºè®®**: åœ¨åº”ç”¨çº§åˆ«ç»´æŠ¤ç¼“å­˜ï¼Œé¿å…é‡å¤è°ƒç”¨

## ğŸ¨ è®¾è®¡åœºæ™¯ä¼˜åŒ–

### è®¾è®¡å¸ˆç½‘ç«™ä¼˜å…ˆçº§

**Prompt ä¸­æŒ‡å®š**:
```json
{
    "search_suggestions": {
        "prioritize_sites": ["pinterest", "behance", "dribbble"],
        "filter_types": ["documentation", "api", "tutorial"]
    }
}
```

### è§†è§‰æŸ¥è¯¢è¯†åˆ«

**Prompt ä¸­è¯†åˆ«**:
- `visual`: è§†è§‰æŸ¥è¯¢ï¼ˆæ‰¾å›¾ç‰‡ã€è®¾è®¡çµæ„Ÿï¼‰
- `object`: ç‰©ä½“æŸ¥è¯¢ï¼ˆæ‰¾ç‰¹å®šç‰©å“ï¼‰
- `color`: é¢œè‰²æŸ¥è¯¢ï¼ˆæ‰¾ç‰¹å®šé¢œè‰²çš„è®¾è®¡ï¼‰
- `style`: é£æ ¼æŸ¥è¯¢ï¼ˆæ‰¾ç‰¹å®šé£æ ¼çš„è®¾è®¡ï¼‰

## ğŸ”„ ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆ

### 1. è§„åˆ™å¼æ–¹æ³•ï¼ˆç°æœ‰ï¼‰

**æ–‡ä»¶**: `smart_filter.py` â†’ `detect_query_intent()`

**ç‰¹ç‚¹**: å¿«é€Ÿã€å¯é¢„æµ‹ã€æ— æˆæœ¬

### 2. AIå¢å¼ºï¼ˆæ–°å¢ï¼‰

**æ–‡ä»¶**: `ai_intent_enhance.py`

**ç‰¹ç‚¹**: æ›´å‡†ç¡®ã€ç†è§£å¤æ‚æ„å›¾ã€æœ‰æˆæœ¬

### 3. æ··åˆç­–ç•¥ï¼ˆæ¨èï¼‰

**æ–‡ä»¶**: `ai_intent_enhance.py` â†’ `hybrid_intent_detection()`

**ç‰¹ç‚¹**: å…¼é¡¾é€Ÿåº¦å’Œå‡†ç¡®æ€§

## ğŸ“ˆ æ•ˆæœè¯„ä¼°

### ä¼˜åŠ¿

âœ… **ç†è§£å¤æ‚æŸ¥è¯¢**: "é€‚åˆåšæµ·æŠ¥çš„é…è‰²æ–¹æ¡ˆ"  
âœ… **å¤„ç†åŒä¹‰è¯**: "æ¤…å­" â†’ "chair", "seat", "seating"  
âœ… **ä¸Šä¸‹æ–‡ç†è§£**: "è“è‰²" â†’ "blue", "azure", "navy"  
âœ… **è®¾è®¡å¸ˆåœºæ™¯ä¼˜åŒ–**: è‡ªåŠ¨è¯†åˆ«è®¾è®¡å¸ˆç½‘ç«™ä¼˜å…ˆçº§

### é™åˆ¶

âš ï¸ **æˆæœ¬**: æ¯æ¬¡æŸ¥è¯¢éœ€è¦è°ƒç”¨ LLM API  
âš ï¸ **å»¶è¿Ÿ**: å¢åŠ  100-2000ms å»¶è¿Ÿ  
âš ï¸ **ä¾èµ–**: éœ€è¦ API å¯†é’¥å’Œç½‘ç»œè¿æ¥

## ğŸš€ æœªæ¥æ”¹è¿›

1. **æœ¬åœ°æ¨¡å‹**: ä½¿ç”¨æœ¬åœ° LLMï¼ˆå¦‚ Ollamaï¼‰é™ä½æˆæœ¬
2. **æ‰¹é‡å¤„ç†**: æ‰¹é‡åˆ†æå¤šä¸ªæŸ¥è¯¢ï¼Œæé«˜æ•ˆç‡
3. **å­¦ä¹ æœºåˆ¶**: ä»ç”¨æˆ·åé¦ˆä¸­å­¦ä¹ ï¼Œä¼˜åŒ– Prompt
4. **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒæ›´å¤šè¯­è¨€çš„æ„å›¾åˆ†æ


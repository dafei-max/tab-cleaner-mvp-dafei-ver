# ç”¨æˆ·IDæŒä¹…åŒ–è¯´æ˜

## âœ… ç”¨æˆ·IDä¸ä¼šå› ä¸ºåˆ·æ–°æ‰©å±•è€Œæ”¹å˜

### æŒä¹…åŒ–æœºåˆ¶

ç”¨æˆ·IDå­˜å‚¨åœ¨ **Chrome Storage Local** ä¸­ï¼Œè¿™æ˜¯æŒä¹…åŒ–å­˜å‚¨ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

1. **æŒä¹…åŒ–å­˜å‚¨**ï¼š
   - æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ç£ç›˜ä¸Š
   - å³ä½¿å…³é—­æµè§ˆå™¨ã€é‡å¯ç”µè„‘ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±
   - **åˆ·æ–°æ‰©å±•ä¸ä¼šæ¸…é™¤æ•°æ®**

2. **å­˜å‚¨ä½ç½®**ï¼š
   - `chrome.storage.local['user_id']` - ç”¨æˆ·ID
   - `chrome.storage.local['device_id']` - è®¾å¤‡IDï¼ˆç”¨äºç”Ÿæˆè®¾å¤‡IDï¼‰

### ç”¨æˆ·IDè·å–æµç¨‹

```javascript
getOrCreateUserId() {
  1. é¦–å…ˆå°è¯•ä» chrome.storage.local è¯»å– 'user_id'
     â”œâ”€ å¦‚æœå­˜åœ¨ â†’ ç›´æ¥è¿”å›ï¼ˆä¸ä¼šé‡æ–°ç”Ÿæˆï¼‰âœ…
     â””â”€ å¦‚æœä¸å­˜åœ¨ â†’ ç»§ç»­ä¸‹ä¸€æ­¥
  
  2. å°è¯•è·å– Google è´¦æˆ·é‚®ç®±
     â”œâ”€ æˆåŠŸ â†’ å“ˆå¸Œé‚®ç®± â†’ ä¿å­˜åˆ° storage â†’ è¿”å›
     â””â”€ å¤±è´¥ â†’ ç»§ç»­ä¸‹ä¸€æ­¥
  
  3. ç”Ÿæˆè®¾å¤‡ID
     â”œâ”€ å…ˆæ£€æŸ¥ storage ä¸­æ˜¯å¦æœ‰ 'device_id'
     â”‚  â”œâ”€ å¦‚æœæœ‰ â†’ ä½¿ç”¨å·²æœ‰çš„ device_id âœ…
     â”‚  â””â”€ å¦‚æœæ²¡æœ‰ â†’ ç”Ÿæˆæ–°çš„å¹¶ä¿å­˜
     â””â”€ è¿”å› device_xxx
}
```

### å…³é”®ç‚¹

âœ… **ç”¨æˆ·IDä¸ä¼šå˜**ï¼Œå› ä¸ºï¼š
- ä»£ç **ä¼˜å…ˆä» storage è¯»å–**å·²ä¿å­˜çš„ç”¨æˆ·ID
- åªæœ‰åœ¨ storage ä¸­æ²¡æœ‰ç”¨æˆ·IDæ—¶ï¼Œæ‰ä¼šç”Ÿæˆæ–°çš„
- Chrome Storage åœ¨æ‰©å±•åˆ·æ–°æ—¶**ä¸ä¼šè¢«æ¸…é™¤**

## ğŸ” éªŒè¯æ–¹æ³•

### æ–¹æ³•1ï¼šåœ¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥

```javascript
// æ£€æŸ¥å½“å‰ç”¨æˆ·ID
chrome.storage.local.get(['user_id', 'device_id'], (result) => {
  console.log('User ID:', result.user_id);
  console.log('Device ID:', result.device_id);
});
```

### æ–¹æ³•2ï¼šåˆ·æ–°æ‰©å±•åæ£€æŸ¥

1. è®°å½•å½“å‰çš„ç”¨æˆ·ID
2. åˆ·æ–°æ‰©å±•ï¼ˆ`chrome://extensions/` â†’ ç‚¹å‡»"é‡æ–°åŠ è½½"ï¼‰
3. å†æ¬¡æ£€æŸ¥ç”¨æˆ·IDï¼Œåº”è¯¥**å®Œå…¨ç›¸åŒ**

## âš ï¸ ä»€ä¹ˆæƒ…å†µä¸‹ç”¨æˆ·IDä¼šæ”¹å˜ï¼Ÿ

### ä¼šæ”¹å˜çš„æƒ…å†µ

1. **æ¸…é™¤æµè§ˆå™¨æ•°æ®**ï¼š
   - æ¸…é™¤æ‰©å±•æ•°æ®
   - æ¸…é™¤æ‰€æœ‰æµè§ˆæ•°æ®ï¼ˆå¦‚æœé€‰æ‹©äº†æ‰©å±•æ•°æ®ï¼‰

2. **æ‰‹åŠ¨åˆ é™¤**ï¼š
   ```javascript
   chrome.storage.local.remove(['user_id', 'device_id']);
   ```

3. **é¦–æ¬¡ä½¿ç”¨**ï¼š
   - ç¬¬ä¸€æ¬¡å®‰è£…æ‰©å±•æ—¶ï¼Œä¼šç”Ÿæˆæ–°çš„ç”¨æˆ·ID

4. **åˆ‡æ¢Googleè´¦æˆ·**ï¼š
   - å¦‚æœä¹‹å‰ä½¿ç”¨è®¾å¤‡IDï¼Œåæ¥ç™»å½•Googleè´¦æˆ·
   - ä¼šä» `device_xxx` åˆ‡æ¢åˆ° `user_xxx`ï¼ˆåŸºäºé‚®ç®±å“ˆå¸Œï¼‰

### ä¸ä¼šæ”¹å˜çš„æƒ…å†µ

âœ… **åˆ·æ–°æ‰©å±•** - ä¸ä¼šæ”¹å˜
âœ… **å…³é—­æµè§ˆå™¨** - ä¸ä¼šæ”¹å˜
âœ… **é‡å¯ç”µè„‘** - ä¸ä¼šæ”¹å˜
âœ… **æ›´æ–°æ‰©å±•** - ä¸ä¼šæ”¹å˜ï¼ˆé™¤éæ¸…é™¤æ•°æ®ï¼‰

## ğŸ› å¦‚æœç”¨æˆ·IDæ„å¤–æ”¹å˜

### å¯èƒ½çš„åŸå› 

1. **Storage è¢«æ¸…é™¤**ï¼š
   - ç”¨æˆ·æ‰‹åŠ¨æ¸…é™¤äº†æ‰©å±•æ•°æ®
   - æµè§ˆå™¨è‡ªåŠ¨æ¸…ç†ï¼ˆå­˜å‚¨ç©ºé—´ä¸è¶³ï¼‰

2. **ä»£ç é€»è¾‘é—®é¢˜**ï¼š
   - æŸä¸ªåœ°æ–¹é”™è¯¯åœ°åˆ é™¤äº† `user_id`
   - Storage API è°ƒç”¨å¤±è´¥

### è§£å†³æ–¹æ¡ˆ

1. **æ£€æŸ¥ Storage**ï¼š
   ```javascript
   chrome.storage.local.get(null, (items) => {
     console.log('All storage:', items);
   });
   ```

2. **æ¢å¤ç”¨æˆ·ID**ï¼ˆå¦‚æœçŸ¥é“ä¹‹å‰çš„IDï¼‰ï¼š
   ```javascript
   chrome.storage.local.set({ 
     user_id: 'device_1764658383255_28u4om0xg' 
   });
   ```

3. **æ•°æ®è¿ç§»**ï¼š
   - å¦‚æœæ•°æ®åœ¨ `anonymous` ä¸‹ï¼Œä½¿ç”¨è¿ç§»è„šæœ¬è¿ç§»åˆ°æ­£ç¡®çš„ç”¨æˆ·ID

## ğŸ“‹ ä»£ç é€»è¾‘ä¿è¯

### ä»£ç ä¸­çš„ä¿æŠ¤æœºåˆ¶

```javascript
// âœ… ä¼˜å…ˆè¯»å–å·²ä¿å­˜çš„ç”¨æˆ·ID
const stored = await chrome.storage.local.get(['user_id']);
if (stored.user_id) {
  return stored.user_id;  // ç›´æ¥è¿”å›ï¼Œä¸é‡æ–°ç”Ÿæˆ
}

// âœ… è®¾å¤‡IDä¹Ÿä¼˜å…ˆä½¿ç”¨å·²ä¿å­˜çš„
const stored = await chrome.storage.local.get(['device_id']);
if (stored.device_id) {
  return `device_${stored.device_id}`;  // ä½¿ç”¨å·²æœ‰çš„
}
```

**ç»“è®º**ï¼šåªè¦ Chrome Storage ä¸­æœ‰ç”¨æˆ·IDï¼Œå°±ä¸ä¼šé‡æ–°ç”Ÿæˆã€‚

## ğŸ¯ æ€»ç»“

| æ“ä½œ | ç”¨æˆ·IDæ˜¯å¦æ”¹å˜ |
|------|--------------|
| åˆ·æ–°æ‰©å±• | âŒ **ä¸ä¼š** |
| å…³é—­æµè§ˆå™¨ | âŒ **ä¸ä¼š** |
| é‡å¯ç”µè„‘ | âŒ **ä¸ä¼š** |
| æ›´æ–°æ‰©å±• | âŒ **ä¸ä¼š** |
| æ¸…é™¤æ‰©å±•æ•°æ® | âœ… **ä¼š** |
| é¦–æ¬¡å®‰è£… | âœ… **ä¼š**ï¼ˆç”Ÿæˆæ–°çš„ï¼‰ |
| åˆ‡æ¢Googleè´¦æˆ· | âš ï¸ **å¯èƒ½**ï¼ˆä» device åˆ‡æ¢åˆ° userï¼‰ |

---

**æœ€åæ›´æ–°**: 2025-12-03

